---
import Layout from './Layout.astro';
import NewsletterForm from '../components/NewsletterForm.astro';
import BookCallout from '../components/BookCallout.astro';
import MDXImage from '../components/MDXImage.astro';
import YouTube from '../components/YouTube.astro';
import ArticleSchema from '../components/ArticleSchema.astro';
import '../styles/global.css';
import { formatDate } from '../utils/date';

export interface Props {
    frontmatter?: {
        title: string;
        description?: string;
        date: string;
        minutesToRead?: number;
        keywords?: string[];
        image?: string;
    };
    title?: string;
    description?: string;
    date?: string;
    minutesToRead?: number;
    keywords?: string[];
    image?: string;
}

const {
    title = 'Untitled Post',
    description = '',
    date = '',
    minutesToRead = 5,
    keywords = [],
    image: frontImage
} = Astro.props.frontmatter || Astro.props;

const slugFromPath = Astro.url.pathname
  .replace(/^\/articles\//, '')
  .replace(/\/$/, '');
const defaultOgImage = `/images/og/${slugFromPath}.png`;
const ogImage = frontImage || defaultOgImage;

const formattedDate = formatDate(date);
const path = Astro.url.pathname;

// Get the success state from the URL
const success = Astro.url.searchParams.get('success') === 'true';

// Get the current URL for the article schema
const url = Astro.url.toString();
---

<Layout
        title={`${title} | Anton Sten`}
        description={description}
        path={path}
        image={ogImage}
>
    <ArticleSchema
        title={title}
        description={description}
        publishDate={new Date(date)}
        image={`https://www.antonsten.com${ogImage}`}
        url={url}
        readingTime={minutesToRead}
        keywords={keywords}
    />
    
    <article class="max-w-[700px] mx-auto px-8 sm:px-6">
        <!-- Article Header -->
        <header class="blog-header">
            <h1 class="h1 text-primary">{title}</h1>
        </header>

        <!-- Article Content -->
        <div class="prose prose-lg max-w-none mb-16">
            <slot />
        </div>

    </article>

    <!-- Newsletter Section -->
    <section class="callout-section">
        <NewsletterForm success={success} />
    </section>

    <section class="callout-section">
        <BookCallout
            heading="Products People Actually Want"
            copy="My book is finally out â€” a practical guide to building products people actually want."
            ctaHref="/books/products-people-actually-want/"
        />
    </section>
</Layout>


<style is:global>
    /* Add any blog-specific global styles here */
    .prose {
        @apply text-[22px] leading-[32px] font-regular;
        color: rgb(var(--color-text));
    }
    
    .prose p {
        @apply mb-8;
    }

    .prose h2 {
        @apply text-[26px] leading-[34px] tracking-[-0.01em] font-medium mt-24 mb-8;
    }

    .prose h3 {
        @apply text-[20px] leading-[28px] tracking-[-0.01em] font-medium mt-16 mb-6;
    }

    .prose ul {
        @apply list-disc mb-8 pl-4;
    }

    .prose ol {
        @apply list-decimal mb-8 pl-4;
    }

    .prose li {
        @apply mb-1 pl-1;
    }

    .prose ul li::marker,
    .prose ol li::marker {
        color: rgb(var(--color-text-muted));
    }

    .prose a {
        @apply underline transition-colors font-regular;
        color: rgb(var(--color-text));
    }

    .prose a:hover {
        color: rgb(var(--color-accent));
    }

    .prose blockquote {
        @apply p-8 rounded-[4px] mb-12 !important;
        background-color: rgb(var(--color-accent-soft));
        color: rgb(var(--color-text));
        border: none;
    }

    .prose blockquote p::before,
    .prose blockquote p::after {
        content: none !important;
        display: none !important;
    }

    .prose blockquote p {
        @apply text-[22px] leading-[32px] mb-4 last:mb-0 font-regular mt-0 !important;
        color: rgb(var(--color-text));
        font-style: normal;
    }

    .prose blockquote p em {
        @apply text-[16px] leading-[32px] mt-12 block font-regular;
        color: rgb(var(--color-text-muted));
        font-style: normal;
    }

    .prose blockquote a {
        @apply text-[16px] leading-[24px] tracking-[-0.01em] font-regular no-underline mt-4 block hover:text-black transition-colors;
        color: rgb(var(--color-text-muted));
    }

    .prose code {
        @apply bg-light-grey px-2 py-1 rounded-[4px] text-[18px] leading-[28px];
    }

    .prose pre {
        @apply bg-light-grey p-6 rounded-[4px] mb-8 overflow-x-auto;
    }

    .prose pre code {
        @apply bg-transparent p-0 text-[16px] leading-[24px];
    }

    .prose img {
        @apply rounded-[4px] mb-8;
    }

    .prose figure {
        @apply mb-8;
    }

    .prose figcaption {
        @apply text-[16px] leading-[24px] text-center mt-4;
        color: rgb(var(--color-text-muted));
    }

    .prose iframe {
        @apply w-full aspect-video rounded-[4px] mb-8;
    }

    .blog-header {
        margin: 20vh auto 4rem;
        text-align: center;
        max-width: 640px;
        display: grid;
        gap: 24px;
    }

    @media (max-width: 768px) {
        .blog-header {
            margin-top: 16vh;
            margin-bottom: 3rem;
            padding: 0 20px;
        }
    }

    .callout-section {
        margin: 20px auto 0;
        padding: 0 20px 40px;
    }
</style>