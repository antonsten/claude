---
// Define the current path to handle active states
const pathname = new URL(Astro.request.url).pathname;
const currentPath = pathname.slice(1); // Remove the leading slash
const isBookPage = currentPath.startsWith('books/products-people-actually-want');
---

<div class="fixed top-0 left-0 right-0 z-50 px-[20px] transform transition-transform duration-300 ease-in-out" id="navigation">
  <nav class="bg-light-grey/90 dark:bg-dark-surface/90 backdrop-blur-sm rounded-[4px] max-w-[960px] mx-auto">
    <div class="px-[20px] py-[8px]">
      <!-- Mobile layout -->
      <div class="flex items-center justify-between md:hidden">
        <a href="/" class="text-black dark:text-dark-text">
          <span class="text-[14px] font-semibold">Anton Sten</span>
        </a>
        <button
          class="text-[14px] font-semibold text-black dark:text-dark-text flex items-center gap-2"
          aria-label="Toggle menu"
          id="menuButton"
        >
          <span id="menuText">Menu</span>
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 6H20M4 12H20M4 18H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>

      <!-- Desktop layout: 3-part grid -->
      <div class="hidden md:grid md:grid-cols-[auto_1fr_auto] md:items-center md:gap-8">
        <!-- Part 1: Brand -->
        <a href="/" class="text-black dark:text-dark-text">
          <span class="text-[14px] font-semibold">Anton Sten</span>
        </a>

        <!-- Part 2: Navigation links (centered) -->
        <div class="flex items-center justify-center gap-2">
          <a
            href="/about/"
            class={`text-[14px] font-semibold text-black dark:text-dark-text hover:opacity-70 px-3 py-1 rounded-[4px] transition-colors ${currentPath === 'about' ? 'text-green' : ''}`}
          >
            About
          </a>
          <a
            href="/articles/"
            class={`text-[14px] font-semibold text-black dark:text-dark-text hover:opacity-70 px-3 py-1 rounded-[4px] transition-colors ${currentPath === 'articles' ? 'text-green' : ''}`}
          >
            Articles
          </a>
          <a
            href="/work/"
            class={`text-[14px] font-semibold text-black dark:text-dark-text hover:opacity-70 px-3 py-1 rounded-[4px] transition-colors ${currentPath === 'work' ? 'text-green' : ''}`}
          >
            Work
          </a>
          <a
            href="/testimonials/"
            class={`text-[14px] font-semibold text-black dark:text-dark-text hover:opacity-70 px-3 py-1 rounded-[4px] transition-colors ${currentPath === 'testimonials' ? 'text-green' : ''}`}
          >
            Testimonials
          </a>
          <a
            href="/newsletter/"
            class={`text-[14px] font-semibold text-black dark:text-dark-text hover:opacity-70 px-3 py-1 rounded-[4px] transition-colors ${currentPath === 'newsletter' ? 'text-green' : ''}`}
          >
            Newsletter
          </a>
          <a
            href="/contact/"
            class={`text-[14px] font-semibold text-black dark:text-dark-text hover:opacity-70 px-3 py-1 rounded-[4px] transition-colors ${currentPath === 'contact' ? 'text-green' : ''}`}
          >
            Contact
          </a>
        </div>

        <!-- Part 3: CTA (right-aligned) -->
        <a
          href="/books/products-people-actually-want/"
          class={`text-[14px] font-semibold text-black dark:text-dark-text hover:opacity-70 px-3 py-1 rounded-[4px] transition-colors ${isBookPage ? 'text-green' : ''}`}
        >
          Get my book
        </a>
      </div>

      <!-- Mobile menu -->
      <div
        class="hidden md:hidden pt-4 pb-6 border-t border-gray-200 dark:border-dark-border mt-4"
        id="mobileMenu"
      >
        <div class="flex flex-col space-y-4">
          <a
            href="/about/"
            class={`text-[14px] font-semibold text-black dark:text-dark-text hover:opacity-70 px-3 py-1 rounded-[4px] transition-colors ${currentPath === 'about' ? 'text-green' : ''}`}
          >
            About
          </a>
          <a
            href="/articles/"
            class={`text-[14px] font-semibold text-black dark:text-dark-text hover:opacity-70 px-3 py-1 rounded-[4px] transition-colors ${currentPath === 'articles' ? 'text-green' : ''}`}
          >
            Articles
          </a>
          <a
            href="/work/"
            class={`text-[14px] font-semibold text-black dark:text-dark-text hover:opacity-70 px-3 py-1 rounded-[4px] transition-colors ${currentPath === 'work' ? 'text-green' : ''}`}
          >
            Work
          </a>
          <a
            href="/testimonials/"
            class={`text-[14px] font-semibold text-black dark:text-dark-text hover:opacity-70 px-3 py-1 rounded-[4px] transition-colors ${currentPath === 'testimonials' ? 'text-green' : ''}`}
          >
            Testimonials
          </a>
          <a
            href="/newsletter/"
            class={`text-[14px] font-semibold text-black dark:text-dark-text hover:opacity-70 px-3 py-1 rounded-[4px] transition-colors ${currentPath === 'newsletter' ? 'text-green' : ''}`}
          >
            Newsletter
          </a>
          <a
            href="/contact/"
            class={`text-[14px] font-semibold text-black dark:text-dark-text hover:opacity-70 px-3 py-1 rounded-[4px] transition-colors ${currentPath === 'contact' ? 'text-green' : ''}`}
          >
            Contact
          </a>
          <a
            href="/books/products-people-actually-want/"
            class={`text-[14px] font-semibold text-black dark:text-dark-text hover:opacity-70 px-3 py-1 rounded-[4px] transition-colors ${isBookPage ? 'text-green' : ''}`}
          >
            Get my book
          </a>
        </div>
      </div>
    </div>
  </nav>
</div>

<script>
  // Mobile menu toggle
  const menuButton = document.getElementById('menuButton');
  const mobileMenu = document.getElementById('mobileMenu');
  const menuText = document.getElementById('menuText');
  const menuIcon = menuButton?.querySelector('svg');

  menuButton?.addEventListener('click', () => {
    mobileMenu?.classList.toggle('hidden');
    const isOpen = !mobileMenu?.classList.contains('hidden');

    // Update text
    if (menuText) {
      menuText.textContent = isOpen ? 'Close' : 'Menu';
    }

    // Rotate the menu icon
    if (menuIcon) {
      menuIcon.style.transform = isOpen ? 'rotate(180deg)' : 'rotate(0deg)';
      menuIcon.style.transition = 'transform 0.3s ease';
    }
  });

  // Navigation scroll behavior
  let lastScrollY = window.scrollY;
  let isScrollingUp = false;
  const navigation = document.getElementById('navigation');

  window.addEventListener('scroll', () => {
    const currentScrollY = window.scrollY;

    // Determine scroll direction
    if (currentScrollY < lastScrollY) {
      // Scrolling up
      isScrollingUp = true;
    } else if (currentScrollY > lastScrollY) {
      // Scrolling down
      isScrollingUp = false;
    }

    // Show/hide navigation based on scroll direction and position
    if (navigation) {
      if (currentScrollY <= 20) {
        // Always show when at top of page
        navigation.style.transform = 'translateY(0)';
      } else if (isScrollingUp) {
        // Show when scrolling up
        navigation.style.transform = 'translateY(0)';
      } else {
        // Hide when scrolling down
        navigation.style.transform = 'translateY(-100%)';
      }
    }

    lastScrollY = currentScrollY;
  });
</script>
