---
import type { WorkCase } from '../data/workCases';
import Button from './ui/Button.astro';

interface Props {
	workCase: WorkCase;
	className?: string;
}

const { workCase, className = '' } = Astro.props as Props;

// Map layout to grid classes
const layoutClasses = {
	'1+1+1': 'grid-cols-3',
	'1+2': 'grid-cols-3',
	'1.5+1.5': 'grid-cols-2',
	'2+1': 'grid-cols-3',
	'1': 'grid-cols-1'
};

const imageClasses = {
	'1+1+1': ['col-span-1', 'col-span-1', 'col-span-1'],
	'1+2': ['col-span-1', 'col-span-2'],
	'1.5+1.5': ['col-span-1', 'col-span-1'],
	'2+1': ['col-span-2', 'col-span-1'],
	'1': ['col-span-1']
};
---

<section class={`work-case ${className}`} data-case-id={workCase.id}>
	<div class="work-case__container">
		<div class="work-case__content">
			<!-- Company Info Column (1 part) -->
			<div class="work-case__company">
				{
					workCase.companyLogo ? (
						<img
							src={workCase.companyLogo}
							alt={workCase.company}
							class="work-case__logo"
							style={workCase.logoSize ? `max-height: ${workCase.logoSize}px;` : undefined}
						/>
					) : (
						<h3 class="h3">{workCase.company}</h3>
					)
				}
				<p class="body-lg text-muted">{workCase.companyDescription}</p>
				{workCase.role && workCase.year && (
					<p class="body-sm text-soft mt-4">
						{workCase.role} · {workCase.year}
					</p>
				)}
			</div>

			<!-- Project Description Column (2 parts) -->
			<div class="work-case__description">
				{workCase.projectDescription.split('\n\n').map((paragraph) => (
					<p class="body-lg" set:html={paragraph}></p>
				))}
				{workCase.inlineImages && workCase.inlineImages.map((image) => (
					<img src={image.src} alt={image.alt} class="work-case__inline-image" />
				))}
				{workCase.tweetUrl && (
					<div class="work-case__tweet-link">
						<a href={workCase.tweetUrl} target="_blank" rel="noopener noreferrer" class="tweet-link">
							View on X (Twitter) →
						</a>
					</div>
				)}
				{workCase.link && (
					<Button href={workCase.link} variant="primary" className="work-case__button">
						View case study
					</Button>
				)}
			</div>
		</div>

		<!-- Image Gallery -->
		<div class={`work-case__gallery ${layoutClasses[workCase.imageLayout]}`}>
			{
				workCase.images.map((image, index) => (
					<div class={imageClasses[workCase.imageLayout][index]}>
						{image.type === 'video' ? (
							<video
								src={image.src}
								autoplay
								loop
								muted
								playsinline
								class="work-case__media"
							>
								<track kind="captions" />
							</video>
						) : (
							<img src={image.src} alt={image.alt} class="work-case__media" loading="lazy" />
						)}
					</div>
				))
			}
		</div>
	</div>
</section>

<style>
	.work-case {
		max-width: 960px;
		margin: 0 auto 96px;
	}

	.work-case__container {
		background: rgb(var(--color-surface));
		border-radius: 4px;
		padding: 48px;
	}

	.work-case__content {
		display: grid;
		grid-template-columns: minmax(0, 1fr) minmax(0, 2fr);
		gap: 48px;
		margin-bottom: 48px;
	}

	.work-case__company {
		display: flex;
		flex-direction: column;
		gap: 12px;
	}

	.work-case__logo {
		max-height: 60px;
		width: auto;
		max-width: 100%;
		object-fit: contain;
		margin-bottom: 8px;
		align-self: flex-start;
	}

	.work-case__description {
		display: flex;
		flex-direction: column;
		align-items: flex-start;
		gap: 24px;
	}

	.work-case__description :global(.work-case__button) {
		background-color: rgb(var(--color-accent));
		color: #ffffff;
	}

	.work-case__description :global(.work-case__button:hover) {
		opacity: 0.9;
	}

	.work-case__description :global(p a) {
		color: rgb(var(--color-accent)) !important;
		text-decoration: none !important;
	}

	.work-case__description :global(p a:hover) {
		text-decoration: underline !important;
	}

	.work-case__description .work-case__inline-image {
		width: 100%;
		height: auto;
		display: block;
		border-radius: 4px;
	}

	/* TITAN inline images - position outside container to sit on white background */
	.work-case[data-case-id="titan"] .work-case__inline-image {
		position: relative;
		/* Create padding area with white background */
		box-sizing: content-box;
		padding: 24px 48px 24px 0;
		/* Extend to right edge of container */
		margin-right: calc(-48px);
		/* Extend vertically to create white background area */
		margin-top: calc(-24px);
		margin-bottom: calc(-24px);
		/* Width of description column + right padding */
		width: 100%;
		border-radius: 0;
		/* Explicit white background */
		background: #FFFFFF;
	}

	@media (max-width: 768px) {
		.work-case[data-case-id="titan"] .work-case__inline-image {
			padding: 24px 24px 24px 0;
			margin-right: calc(-24px);
		}
	}

	.work-case__description .work-case__tweet-link {
		width: 100%;
	}

	.work-case__description .tweet-link {
		display: inline-flex;
		align-items: center;
		color: rgb(var(--color-accent));
		text-decoration: none;
		font-size: 1.125rem;
		line-height: 1.625rem;
		letter-spacing: -0.01em;
		transition: opacity 0.2s;
	}

	.work-case__description .tweet-link:hover {
		opacity: 0.8;
	}

	.work-case__gallery {
		display: grid;
		gap: 24px;
		width: 100%;
	}

	.work-case__gallery > div {
		padding: 40px;
		background: rgb(var(--color-background));
		border-radius: 4px;
		display: flex;
		align-items: center;
		justify-content: center;
	}

	.work-case__gallery.grid-cols-1 > div {
		padding: 0;
		background: transparent;
	}

	/* Remove padding for TITAN only */
	.work-case[data-case-id="titan"] .work-case__gallery > div {
		padding: 0;
		background: transparent;
		display: block;
		overflow: hidden;
	}

	.work-case[data-case-id="titan"] .work-case__media {
		width: 100%;
		height: 100%;
		object-fit: cover;
		min-height: 400px;
	}

	/* Remove padding for Żabka and crop videos */
	.work-case[data-case-id="zakka"] .work-case__gallery > div {
		padding: 0;
		background: transparent;
		display: block;
		overflow: hidden;
	}

	.work-case[data-case-id="zakka"] .work-case__media {
		width: 100%;
		height: 100%;
		object-fit: cover;
		min-height: 400px;
	}

	/* Remove padding for Herman Miller and crop videos */
	.work-case[data-case-id="personalized"] .work-case__gallery > div {
		padding: 0;
		background: transparent;
		display: block;
		overflow: hidden;
	}

	.work-case[data-case-id="personalized"] .work-case__media {
		width: 100%;
		height: 100%;
		object-fit: cover;
		min-height: 400px;
	}

	/* Remove padding for Toast and crop media */
	.work-case[data-case-id="chassi"] .work-case__gallery > div {
		padding: 0;
		background: transparent;
		display: block;
		overflow: hidden;
	}

	.work-case[data-case-id="chassi"] .work-case__media {
		width: 100%;
		height: 100%;
		object-fit: cover;
		min-height: 400px;
	}

	.work-case__media {
		width: 100%;
		height: auto;
		display: block;
		border-radius: 4px;
	}

	.work-case__gallery.grid-cols-1 .work-case__media {
		border-radius: 4px;
	}

	/* Mobile responsive */
	@media (max-width: 768px) {
		.work-case {
			margin-bottom: 64px;
		}

		.work-case__container {
			padding: 32px 24px;
		}

		.work-case__content {
			grid-template-columns: 1fr;
			gap: 32px;
			margin-bottom: 32px;
		}

		.work-case__gallery {
			grid-template-columns: 1fr !important;
			gap: 16px;
		}

		.work-case__gallery > * {
			grid-column: span 1 !important;
		}
	}
</style>
