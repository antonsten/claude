---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import PersonSchema from '../components/PersonSchema.astro';

export async function getStaticPaths() {
  const pages = await getCollection('pages');
  return pages.map(page => ({
    params: { slug: page.slug || page.data.path.replace(/^\//, '') },
    props: { page },
  }));
}

// Get the current slug from the URL
const slug = Astro.params.slug;

// Get the page from props
const { page } = Astro.props;

// If no page is found, redirect to 404
if (!page) {
  return Astro.redirect('/404');
}

// Render the page content
const { Content } = await page.render();
const { title, description, path, personSchema } = page.data;
---

<Layout 
  title={title}
  description={description}
  path={path}
>
  {path === '/about' && <PersonSchema />}
  <div class="max-w-[700px] mx-auto px-8 sm:px-6 mt-[20vh]">
    <Content />
  </div>
</Layout> 