---
import Layout from '../layouts/Layout.astro';
import NewsletterForm from '../components/NewsletterForm.astro';
import TestimonialCard from '../components/TestimonialCard.astro';
import { Image } from 'astro:assets';
import anton from '../assets/anton.png';
import { getCollection } from 'astro:content';

// Welcome to Astro! Wondering what to do next? Check out the Astro documentation at https://docs.astro.build
// Don't want to use any of this? Delete everything in this file, the `assets`, `components`, and `layouts` directories, and start fresh.

// Get the success state from the URL
const success = Astro.url.searchParams.get('success') === 'true';

// Fetch the five most recent articles
const featuredArticles = (await getCollection('articles'))
        .sort((a, b) => {
                const dateA = a.data.date ? new Date(a.data.date) : new Date(0);
                const dateB = b.data.date ? new Date(b.data.date) : new Date(0);
                return dateB.getTime() - dateA.getTime();
        })
        .slice(0, 5)
        .map(article => ({
                title: article.data.title,
                url: `/articles/${article.slug}`,
                date: article.data.date
        }));

// Fetch testimonials for the stacked card display (first 3)
const allTestimonials = (await getCollection('testimonials'))
        .sort((a, b) => (a.data.order || 0) - (b.data.order || 0));
const featuredTestimonials = allTestimonials.slice(0, 3);
---

<Layout title="Home | Anton Sten – UX Lead & Product Designer" description="I'm a UX lead and product designer helping startups build user-focused digital products and brands." image="/images/og/home.png">
	<!-- Hero Section -->
	<div class="px-8 sm:px-6 mt-[30vh] sm:mt-[40vh]">
		<div class="flex flex-col gap-20">
			<div class="w-[80%] max-w-[900px]">
				<h1>
					<span class="block text-black font-medium text-[40px] sm:text-[48px] leading-[1.2] tracking-[-0.02em] sm:text-display">I help founders and startups turn ideas into great digital products and brands.</span>
				</h1>
			</div>
		</div>
	</div>

	<div class="max-w-[700px] mx-auto px-8 sm:px-6 mt-40">
		<div class="space-y-6 mb-20">
			<h3 class="body-xxl mb-24">I've spent 25+ years designing apps and websites, working with companies like Google, Loom, Spotify, IKEA, Herman Miller, and many others.<br /><br />Big companies, small startups—it's the same problem at the core. Build something people actually want to use.<br /><br />Right now, I'm leading design at <a href="https://summerhealth.com" class="text-black underline hover:text-green">Summer Health</a> ☀️, building tools to help raise the healthiest generation of kids.</h3>
		</div>

		<!-- Companies Section -->
		<!--
		<section class="mb-20">
			<div class="relative">
				<div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
					<div class="bg-light-grey w-full aspect-[170/90] rounded-[4px] flex items-center justify-center px-5">
						<img src="/logos/google.svg" alt="Google" class="h-5" loading="lazy" />
					</div>

					<div class="bg-light-grey w-full aspect-[170/90] rounded-[4px] flex items-center justify-center px-5">
						<img src="/logos/loom.svg" alt="Loom" class="h-5" loading="lazy" />
					</div>

					<div class="bg-light-grey w-full aspect-[170/90] rounded-[4px] flex items-center justify-center px-5">
						<img src="/logos/ueno.svg" alt="Ueno logo" class="h-4" loading="lazy" />
					</div>

					<div class="bg-light-grey w-full aspect-[170/90] rounded-[4px] flex items-center justify-center px-5">
						<img src="/logos/spotify.svg" alt="Spotify" class="h-5" loading="lazy" />
					</div>

					<div class="bg-light-grey w-full aspect-[170/90] rounded-[4px] flex items-center justify-center px-5">
						<img src="/logos/herman-miller.svg" alt="Herman Miller" class="h-4" loading="lazy" />
					</div>

					<div class="bg-light-grey w-full aspect-[170/90] rounded-[4px] flex items-center justify-center px-5">
						<img src="/logos/ikea.svg" alt="IKEA" class="h-4" loading="lazy" />
					</div>
				</div>
			</div>
		</section>
		-->

		<!-- Newsletter Section -->
		<section class="mb-20">
			<NewsletterForm success={success} />
		</section>

		<!-- Testimonials Section -->
		<section class="mb-20">
			<h2 class="text-black body-xxl mb-8">What clients say</h2>
			<div class="relative max-w-[600px] mx-auto">
				<!-- Stacked cards container -->
				<div class="relative h-[400px] sm:h-[420px]">
					{featuredTestimonials.map((testimonial, index) => (
						<div
							class="absolute w-full transition-all duration-300"
							style={{
								zIndex: 3 - index,
								transform: `translateY(${index * 20}px) scale(${1 - index * 0.04})`,
								opacity: 1 - index * 0.2
							}}
						>
							<TestimonialCard
								quote={testimonial.data.quote}
								author={testimonial.data.author}
								role={testimonial.data.role}
								bgColor={testimonial.data.bgColor}
								textColor={testimonial.data.textColor}
								logo={testimonial.data.logo}
								class="shadow-lg"
							/>
						</div>
					))}
				</div>
				<!-- CTA -->
				<div class="text-center mt-8">
					<a
						href="/testimonials"
						class="inline-block px-6 py-3 bg-black text-white rounded-lg hover:bg-green transition-colors font-medium"
					>
						See all testimonials →
					</a>
				</div>
			</div>
		</section>

                <!-- Recent Writing Section -->
                <section>
                        <h2 class="text-black body-xxl mb-8">Recent writing</h2>
			<div class="h-px bg-light-grey mb-8"></div>
			<div class="space-y-8">
				{featuredArticles.map(article => (
					<div>
						<div class="flex justify-between items-start">
							<h3 class="body-lg font-medium">
								<a href={article.url} class="hover:text-green transition-colors">
									{article.title}
								</a>
							</h3>
							<span class="body-sm text-dark-grey">{new Date(article.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
						</div>
						<div class="h-px bg-light-grey mt-8"></div>
					</div>
				))}
				<div>
					<div class="flex justify-between items-start">
						<h3 class="body-lg font-medium">
							<a href="/articles/" class="hover:text-green transition-colors">
								See all
							</a>
						</h3>
					</div>
				</div>
			</div>
		</section>
	</div>


</Layout>

<style>
	@keyframes rotateIcon {
		from {
			transform: rotate(0deg);
		}
		to {
			transform: rotate(360deg);
		}
	}

	.group:hover img {
		animation: rotateIcon 1s ease-in-out;
	}
</style>
