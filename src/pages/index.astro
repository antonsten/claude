---
import Layout from '../layouts/Layout.astro';
import Hero from '../components/Hero.astro';
import NewsletterForm from '../components/NewsletterForm.astro';
import TestimonialGrid from '../components/TestimonialGrid.astro';
import CalloutSection from '../components/CalloutSection.astro';
import { getCollection } from 'astro:content';
import { testimonials } from '../data/testimonials';

// Get the success state from the URL
const success = Astro.url.searchParams.get('success') === 'true';

// Fetch the five most recent articles
const featuredArticles = (await getCollection('articles'))
  .sort((a, b) => {
    const dateA = a.data.date ? new Date(a.data.date) : new Date(0);
    const dateB = b.data.date ? new Date(b.data.date) : new Date(0);
    return dateB.getTime() - dateA.getTime();
  })
  .slice(0, 5)
  .map((article) => {
    const dateValue = article.data.date ? new Date(article.data.date) : null;

    const formattedDate = dateValue
      ? `${dateValue.toLocaleDateString('en-GB', { day: '2-digit' })} ${dateValue.toLocaleDateString('en-GB', { month: 'short' })}, ${dateValue.getFullYear()}`
      : null;

    return {
      title: article.data.title,
      url: `/articles/${article.slug}`,
      date: dateValue ? dateValue.toISOString() : null,
      formattedDate
    };
  });
---

<Layout
  title="Home | Anton Sten – UX Lead & Product Designer"
  description="I'm a UX lead and product designer helping startups build user-focused digital products and brands."
  image="/images/og/home.png"
>
  <div class="page-shell">
    <Hero title="Product design and branding for startups.">
      <p class="h3">
        I've spent 25+ years leading and practicing product design. I work across strategy, research, and interface design, but the heart of my work is shaping products that feel clear, useful, and genuinely human.
      </p>
      <p class="h3">
        Today I lead design at
        <a href="https://summerhealth.com" class="text-accent underline decoration-2 underline-offset-4 hover:opacity-80">Summer Health</a>,
        building 24/7 pediatric care that supports parents through the hard moments.
      </p>
    </Hero>

    <section class="newsletter-section">
      <NewsletterForm
        success={success}
        heading="Get design insights, case studies, and lessons learned in your inbox—join 3,000+ designers and product people."
      />
    </section>

    <TestimonialGrid testimonials={testimonials.slice(0, 6)} className="mb-24" />

    <CalloutSection title="Recent writing" className="writing-callout">
      <div class="writing-list">
        {featuredArticles.map((article) => (
          <article class="writing-item">
            {article.formattedDate && (
              <time class="body text-muted" datetime={article.date}>
                {article.formattedDate}
              </time>
            )}
            <h3 class="body-lg text-primary">
              <a href={article.url} class="hover:text-accent transition-colors duration-150">
                {article.title}
              </a>
            </h3>
          </article>
        ))}
      </div>
    </CalloutSection>
  </div>
</Layout>

<style>
  .page-shell {
    max-width: 1080px;
    margin: 0 auto;
    padding: 0 20px 120px;
  }

  .newsletter-section {
    margin-bottom: 96px;
  }

  .writing-callout {
    margin-bottom: 96px;
  }

  .writing-list {
    display: grid;
    gap: 24px;
  }

  .writing-item {
    display: grid;
    gap: 0;
  }

  .writing-item time {
    color: rgb(var(--color-text-muted));
  }
</style>
